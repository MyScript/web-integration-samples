makeInstaller=function(n){"use strict";var e=(n=n||{}).extensions||[".js",".json"],t=n.onInstall,o=n.wrapRequire,f=n.override,i=n.fallback,l=n.mainFields||(n.browser?["browser","main"]:["main"]),r={}.hasOwnProperty;function u(n,e){return y(n)&&w(e)&&r.call(n,e)}var s,c,a={},d=new I("/",new I("/..")),p=j(d);function v(n,e){return y(n)&&(!function r(o,e,i){Array.isArray(e)?(e.forEach(function(n){w(n)?o.deps[n]=o.module.id:b(n)?e=n:y(n)&&(o.stub=o.stub||{},A(n,function(n,e){o.stub[e]=n}))}),b(e)||(e=null)):b(e)||w(e)||y(e)||(e=null);e&&(o.contents=o.contents||(y(e)?{}:e),y(e)&&g(o)&&A(e,function(n,e){if(".."===e)t=o.parent;else{var t=m(o.contents,e);t||((t=o.contents[e]=new I(o.module.id.replace(/\/*$/,"/")+e,o)).options=i)}r(t,n,i)}))}(d,n,e),b(t)&&t(p)),p}function h(n){this.id=n,this.children=[],this.childrenById={}}function m(n,e){return u(n,e)&&n[e]}function y(n){return null!==n&&"object"==typeof n}function b(n){return"function"==typeof n}function w(n){return"string"==typeof n}function x(n){return new Error("Cannot find module '"+n+"'")}function j(r){function n(n){var e=P(r,n);if(e)return k(e,r.module);var t=x(n);if(b(i))return i(n,r.module.id,t);throw t}return b(o)&&(n=o(n,r.module)),n.extensions=q(r).slice(0),n.resolve=function(n){var e=P(r,n);if(e)return e.module.id;var t=x(n);if(i&&b(i.resolve))return i.resolve(n,r.module.id,t);throw t},n}function I(n,e){var t=this;t.parent=e=e||null,t.module=new h(n),(a[n]=t).contents=null,t.deps={}}function k(n,e){var t=n.module;if(!u(t,"exports")){var r=n.contents;if(!r){if(n.stub)return n.stub;throw x(t.id)}if(e){var o=(t.parent=e).children;Array.isArray(o)&&o.push(t)}r(t.require=t.require||j(n),t.exports=n.stub||{},t,n.module.id,n.parent.module.id),t.loaded=!0}var i=t.runSetters||t.runModuleSetters;return b(i)&&i.call(t),t.exports}function g(n){return n&&y(n.contents)}function A(e,t,n){Object.keys(e).forEach(function(n){t.call(this,e[n],n)},n)}function q(n){return n.options&&n.options.extensions||e}function B(n,e,t){for(;n&&!g(n);)n=n.parent;if(!n||!e||"."===e)return n;if(".."===e)return n.parent;var r=m(n.contents,e);if(t&&(!r||g(r)))for(var o=0;o<t.length;++o){var i=m(n.contents,e+t[o]);if(i&&!g(i))return i}return r}function E(t,n,r){var o=n.split("/");return o.every(function(n,e){return t=e<o.length-1?B(t,n):B(t,n,r)}),t}function O(n,e){var t=e&&e.module;n&&t&&(n.childrenById[t.id]=t)}function P(n,e,t,r){t=t||n.module;var o=q(n);for(n="/"===e.charAt(0)?E(d,e,o):"."===e.charAt(0)?E(n,e,o):function(n,e,t){b(f)&&(e=f(e,n.module.id));if(w(e)){for(var r;n&&!r;n=n.parent)r=g(n)&&E(n,"node_modules/"+e,t);return r}}(n,e,o);g(n);){if((r=r||[]).indexOf(n)<0){r.push(n);var i,u=B(n,"package.json"),s=u&&k(u,t);if(s&&l.some(function(n){return w(i=s[n])})){var c=E(n,i,o)||P(n,i,t,r);if(c){n=c,O(t,u);continue}}}n=B(n,"index.js")}return n&&w(n.contents)&&(n=P(n,n.contents,t,r)),O(t,n),n}return v.fetch=function(n){throw new Error("fetch not implemented")},h.prototype.resolve=function(n){return this.require.resolve(n)},h.prototype.prefetch=function(t){var r=this,o=(m(a,r.id),s=s||Promise.resolve());function i(n){var e,t=m(a,n.id);(e=t)&&null===e.contents&&!t.pending&&(t.pending=!0,(c=c||{})[n.id]={module:t.module,deps:Object.keys(t.deps),options:t.options,stub:t.stub},A(t.deps,function(n,e){P(t,e)}),A(n.childrenById,i))}return s=new Promise(function(n){var e=r.resolve(t);A(r.childrenById,i),n(e)}).then(function(t){var n=c;return c=null,Promise.resolve(n&&v.fetch(n)).then(function(n){function e(){return v(n),t}return o.then(e,e)})})},v.Module=h,v},"object"==typeof exports&&(exports.makeInstaller=makeInstaller);
